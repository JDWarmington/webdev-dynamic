<h2>$$$TITLE$$$</h2>

<div class="data-summary">
  <p>
    Forest fires categorized by wind speed conditions. Click on any category to
    view detailed fire data.
  </p>
</div>

<!-- Wind Categories Grid -->
<div class="wind-categories">$$$WIND_CARDS$$$</div>

<!-- Wind Analysis Chart -->
<div class="chart">
  <h3>Fire Distribution by Wind Speed</h3>
  <canvas id="windChart"></canvas>
</div>

<script>
  // Delay chart initialization until DOM and Chart.js are ready
  document.addEventListener("DOMContentLoaded", function () {
    const canvas = document.getElementById("windChart");
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    const windData = $$$WIND_STATS_JSON$$$;

    if (window.Chart) {
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: windData.map((item) => item.wind_category),
          datasets: [
            {
              label: "Number of Fires",
              data: windData.map((item) => item.count),
              backgroundColor: [
                "#36A2EB",
                "#4BC0C0",
                "#FFCE56",
                "#FF6384",
                "#9966FF",
              ],
              borderColor: [
                "#36A2EB",
                "#4BC0C0",
                "#FFCE56",
                "#FF6384",
                "#9966FF",
              ],
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: "Number of Fires" },
            },
            x: {
              title: { display: true, text: "Wind Speed Categories" },
            },
          },
          plugins: {
            title: {
              display: true,
              text: "Fire Distribution by Wind Conditions",
            },
          },
        },
      });
      return;
    }

    // Fallback drawing if Chart.js is not present
    const labels = windData.map((d) => d.wind_category);
    const values = windData.map((d) => d.count);
    const width = canvas.width;
    const height = canvas.height;
    const margin = { top: 26, right: 10, bottom: 64, left: 40 };
    const chartW = width - margin.left - margin.right;
    const chartH = height - margin.top - margin.bottom;

    ctx.clearRect(0, 0, width, height);
    ctx.save();
    ctx.translate(margin.left, margin.top);

    const maxVal = Math.max(1, ...values);
    const n = values.length;
    const gap = 10;
    const barW = (chartW - gap * (n - 1)) / n;

    // axes
    ctx.strokeStyle = "#444";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(0, chartH);
    ctx.lineTo(chartW, chartH);
    ctx.stroke();

    // ticks
    ctx.fillStyle = "#333";
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";
    ctx.font = "12px Arial";
    ctx.fillText("0", -6, chartH);
    ctx.fillText(String(maxVal), -6, 0);

    // bars
    for (let i = 0; i < n; i++) {
      const x = i * (barW + gap);
      const h = (values[i] / maxVal) * chartH;
      ctx.fillStyle = "#36A2EB";
      ctx.fillRect(x, chartH - h, barW, h);
    }

    // x labels
    ctx.save();
    ctx.translate(0, chartH + 8);
    ctx.textAlign = "right";
    ctx.textBaseline = "top";
    ctx.font = "11px Arial";
    for (let i = 0; i < n; i++) {
      const x = i * (barW + gap) + barW / 2;
      ctx.save();
      ctx.translate(x, 0);
      ctx.rotate(-Math.PI / 6);
      ctx.fillStyle = "#333";
      ctx.fillText(labels[i], 0, 0);
      ctx.restore();
    }
    ctx.restore();

    // title
    ctx.fillStyle = "#111";
    ctx.textAlign = "center";
    ctx.textBaseline = "top";
    ctx.font = "14px Arial";
    ctx.fillText("Fire Distribution by Wind Conditions", chartW / 2, -22);

    ctx.restore();
  });
</script>
